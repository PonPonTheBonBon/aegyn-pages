<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Location XML Editor</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			margin: 20px;
		}
		h2 {
			display: block;
		}
		th, td {
			padding-right: 18px;
		}
		.section {
			margin-bottom: 20px;
		}
		.flex-container {
			display: flex;
			flex-wrap: wrap;
			gap: 10px;
		}
		#resultSection {
			font-family: Consolas, monospace;
		}
		label {
			display: block;
			margin-top: 10px;
		}
		input {
			padding: 5px;
			margin-top: 5px;
			font-family: Consolas, monospace;
		}
		input#english-name {
			font-family: Arial, sans-serif;
		}
		.rule {
			padding-bottom: 5px;
			border-bottom: 1px solid #767676;
		}
		.rule:last-child {
			border-bottom: none;
		}
		.year {
			padding-bottom: 5px;
			border-bottom: 1px solid #767676;
		}
		.year:last-child {
			border-bottom: none;
		}
		.btn {
			display: inline-block;
			padding: 10px 20px;
			margin-top: 10px;
			cursor: pointer;
			background-color: #FA3B7B;
			color: white;
			border: none;
			border-radius: 4px;
			transition: background-color 150ms linear;
		}
		.btn:hover, .btn:focus {
			background-color: #E01F60;
		}
		.btn:active {
			background-color: #C70848;
			transition: background-color 0ms linear;
		}
		.btn:disabled {
			padding: 9px 19px;
			background-color: #FFFFFF;
			color: #FA3B7B;
			border: 1px solid #FA3B7B;
			cursor: default;
			transition: background-color 0ms linear;
		}
		.xml-output {
			white-space: pre;
			background-color: #f8f8f8;
			padding: 10px;
			border: 1px solid #ccc;
		}
		hr {
			border: none;
			border-top: 1px solid #767676;
			overflow: visible;
			text-align: center;
			height: 1px;
		}
	</style>
	<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->
</head>
<body>
	<h2>Import XML</h2>
	<div class="section">
		<textarea id="xmlInput" rows="10" style="width: 100%;"></textarea>
		<button class="btn" id="importButton" onclick="importXML()">Import</button>
	</div>
	<h2>Location Information</h2>
	<div class="section flex-container">
		<label>ID</label><input type="text" id="loc-id" maxlength="11" style="width: 11ch;">
		<label>Name</label><input type="text" id="loc-name" style="width: 25ch;">
		<label>C</label><input type="text" id="country" maxlength="2" style="width: 2ch;">
		<label>S</label><input type="text" id="subdivision" maxlength="4" style="width: 4ch;">
		<label>D</label><input type="text" id="district" maxlength="4" style="width: 4ch;">
		<label>Latitude</label><input type="number" id="latitude" step="0.0000001" style="width: 14ch;">
		<label>Longitude</label><input type="number" id="longitude" step="0.0000001" style="width: 14ch;">
	</div>
	<hr/>
	<h2>Calendar Rules</h2>
	<div class="section" id="rulesSection">
		<!-- Dynamic rule entries will be added here -->
	</div>
	<button class="btn" id="rulesButton" onclick="addRule()">Add Rule</button>
	<hr/>
	<h2>Calendar Years</h2>
	<div class="section" id="yearsSection">
		<!-- Dynamic year entries will be added here -->
	</div>
	<button class="btn" id="yearsButton" onclick="addYear()">Add Year</button>
	<hr/>
	<h2>Results</h2>
	<div class="section" id="resultSection">
		<span id="resultOutput" class="result-output"></span>
		<!-- Dynamic result entries will be added here -->
	</div>
	<hr/>
	<h2>Output XML</h2>
	<div class="section">
		<pre id="xmlOutput" class="xml-output"></pre>
		<button class="btn" id="outputButton" onclick="copyXML()">Copy XML</button>
	</div>
	
	<script>
		Number.prototype.mod = function (n) {
			"use strict";
			return ((this % n) + n) % n;
		};

		const xmlInput = document.getElementById('xmlInput');
		const xmlOutput = document.getElementById('xmlOutput');
		const locID = document.getElementById('loc-id');
		const locName = document.getElementById('loc-name');
		const country = document.getElementById('country');
		const subdivision = document.getElementById('subdivision');
		const district = document.getElementById('district');
		const latitude = document.getElementById('latitude');
		const longitude = document.getElementById('longitude');
		const rulesSection = document.getElementById('rulesSection');
		const yearsSection = document.getElementById('yearsSection');

		const countryNames = {
			"AC": "Ascension Isl.", "AD": "Andorra", "AE": "UAE", "AF": "Afghanistan", "AG": "Antigua-Barbuda", "AI": "Anguilla", "AL": "Albania", "AM": "Armenia", "AO": "Angola", "AQ": "Antarctica", "AR": "Argentina", "AS": "Am. Samoa", "AT": "Austria", "AU": "Australia", "AW": "Aruba", "AX": "Åland Isl.", "AZ": "Azerbaijan", "BA": "Bosnia-Herzeg.", "BB": "Barbados", "BD": "Bangladesh", "BE": "Belgium", "BF": "Burkina Faso", "BG": "Bulgaria", "BH": "Bahrain", "BI": "Burundi", "BJ": "Benin", "BL": "St Barthélemy", "BM": "Bermuda", "BN": "Brunei", "BO": "Bolivia", "BQ": "Carib. Netherl.", "BR": "Brazil", "BS": "Bahamas", "BT": "Bhutan", "BV": "Bouvet Isl.", "BW": "Botswana", "BY": "Belarus", "BZ": "Belize", "CA": "Canada", "CC": "Cocos-Keel. Isl.", "CD": "DR Congo", "CF": "CAR", "CG": "Rep. Congo", "CH": "Switzerland", "CI": "Côte d’Ivoire", "CK": "Cook Isl.", "CL": "Chile", "CM": "Cameroon", "CN": "China", "CO": "Colombia", "CP": "Clipperton Isl.", "CR": "Costa Rica", "CU": "Cuba", "CV": "Cape Verde", "CW": "Curaçao", "CX": "Christmas Isl.", "CY": "Cyprus", "CZ": "Czechia", "DE": "Germany", "DG": "Diego Garcia", "DJ": "Djibouti", "DK": "Denmark", "DM": "Dominica", "DO": "Dominican Rep.", "DZ": "Algeria", "EA": "Ceuta-Melilla", "EC": "Ecuador", "EE": "Estonia", "EG": "Egypt", "EH": "Western Sahara", "ER": "Eritrea", "ES": "Spain", "ET": "Ethiopia", "FI": "Finland", "FJ": "Fiji", "FK": "Falkland Isl.", "FM": "Micronesia", "FO": "Faroe Isl.", "FR": "France", "GA": "Gabon", "GB": "UK", "GD": "Grenada", "GE": "Georgia", "GF": "French Guiana", "GG": "Guernsey", "GH": "Ghana", "GI": "Gibraltar", "GL": "Greenland", "GM": "Gambia", "GN": "Guinea", "GP": "Guadeloupe", "GQ": "Equatorial Guinea", "GR": "Greece", "GS": "S.Geo.-S.San. Isl.", "GT": "Guatemala", "GU": "Guam", "GW": "Guinea-Bissau", "GY": "Guyana", "HK": "Hong Kong", "HM": "Heard-McD. Isl.", "HN": "Honduras", "HR": "Croatia", "HT": "Haiti", "HU": "Hungary", "IC": "Canary Isl.", "ID": "Indonesia", "IE": "Ireland", "IL": "Israel", "IM": "Isle of Man", "IN": "India", "IO": "Br.In. Ocean Terr.", "IQ": "Iraq", "IR": "Iran", "IS": "Iceland", "IT": "Italy", "JE": "Jersey", "JM": "Jamaica", "JO": "Jordan", "JP": "Japan", "KE": "Kenya", "KG": "Kyrgyzstan", "KH": "Cambodia", "KI": "Kiribati", "KM": "Comoros", "KN": "St Kitts-Nevis", "KP": "North Korea", "KR": "South Korea", "KW": "Kuwait", "KY": "Cayman Isl.", "KZ": "Kazakhstan", "LA": "Laos", "LB": "Lebanon", "LC": "St Lucia", "LI": "Liechtenstein", "LK": "Sri Lanka", "LR": "Liberia", "LS": "Lesotho", "LT": "Lithuania", "LU": "Luxembourg", "LV": "Latvia", "LY": "Libya", "MA": "Morocco", "MC": "Monaco", "MD": "Moldova", "ME": "Montenegro", "MF": "St Martin", "MG": "Madagascar", "MH": "Marshall Isl.", "MK": "N.Macedonia", "ML": "Mali", "MM": "Myanmar", "MN": "Mongolia", "MO": "Macao", "MP": "N.Mariana Isl.", "MQ": "Martinique", "MR": "Mauritania", "MS": "Montserrat", "MT": "Malta", "MU": "Mauritius", "MV": "Maldives", "MW": "Malawi", "MX": "Mexico", "MY": "Malaysia", "MZ": "Mozambique", "NA": "Namibia", "NC": "New Caledonia", "NE": "Niger", "NF": "Norfolk Isl.", "NG": "Nigeria", "NI": "Nicaragua", "NL": "Netherlands", "NO": "Norway", "NP": "Nepal", "NR": "Nauru", "NU": "Niue", "NZ": "New Zealand", "OM": "Oman", "PA": "Panama", "PE": "Peru", "PF": "Fr. Polynesia", "PG": "PNG", "PH": "Philippines", "PK": "Pakistan", "PL": "Poland", "PM": "St Pierre-Miqu.", "PN": "Pitcairn Isl.", "PR": "Puerto Rico", "PS": "Palestine", "PT": "Portugal", "PW": "Palau", "PY": "Paraguay", "QA": "Qatar", "RE": "Réunion", "RO": "Romania", "RS": "Serbia", "RU": "Russia", "RW": "Rwanda", "SA": "Saudi Arabia", "SB": "Solomon Isl.", "SC": "Seychelles", "SD": "Sudan", "SE": "Sweden", "SG": "Singapore", "SH": "St Helena", "SI": "Slovenia", "SJ": "Svalb.-Jan M.", "SK": "Slovakia", "SL": "Sierra Leone", "SM": "San Marino", "SN": "Senegal", "SO": "Somalia", "SR": "Suriname", "SS": "South Sudan", "ST": "S.Tomé-Prínc.", "SV": "El Salvador", "SX": "Sint Maarten", "SY": "Syria", "SZ": "Eswatini", "TA": "Tristan da C.", "TC": "Turks-Caicos Isl.", "TD": "Chad", "TF": "French S.Terr.", "TG": "Togo", "TH": "Thailand", "TJ": "Tajikistan", "TK": "Tokelau", "TL": "Timor-Leste", "TM": "Turkmenistan", "TN": "Tunisia", "TO": "Tonga", "TR": "Turkey", "TT": "Trinidad-Tobago", "TV": "Tuvalu", "TW": "Taiwan", "TZ": "Tanzania", "UA": "Ukraine", "UG": "Uganda", "UM": "US Outl. Isl.", "US": "US", "UY": "Uruguay", "UZ": "Uzbekistan", "VA": "Vatican City", "VC": "St Vinc.-Gren.", "VE": "Venezuela", "VG": "UK Virgin Isl.", "VI": "US Virgin Isl.", "VN": "Vietnam", "VU": "Vanuatu", "WF": "Wallis-Futuna", "WS": "Samoa", "XK": "Kosovo", "XN": "N.Cyprus", "YE": "Yemen", "YT": "Mayotte", "ZA": "S.Africa", "ZM": "Zambia", "ZW": "Zimbabwe", "ZZ": ""
		};
		const subdivisionNames = {
			"CA": {
				"AB": "Alberta", "BC": "British Columbia", "MB": "Manitoba", "NB": "New Brunswick", "NL": "Newfoundland and Labrador", "NS": "Nova Scotia", "NT": "Northwest Territories", "NU": "Nunavut", "ON": "Ontario", "PE": "Prince Edward Island", "QC": "Quebec", "SK": "Saskatchewan", "YT": "Yukon"
			},
			"GB": {
				"ENG": "England", "NIR": "Northern Ireland", "SCT": "Scotland", "WLS": "Wales"
			},
			"US": {
				"AK": "Alaska", "AL": "Alabama", "AR": "Arkansas", "AZ": "Arizona", "CA": "California", "CO": "Colorado", "CT": "Connecticut", "DE": "Delaware", "FL": "Florida", "GA": "Georgia", "HI": "Hawaii", "IA": "Iowa", "ID": "Idaho", "IL": "Illinois", "IN": "Indiana", "KS": "Kansas", "KY": "Kentucky", "LA": "Louisiana", "MA": "Massachusetts", "MD": "Maryland", "ME": "Maine", "MI": "Michigan", "MN": "Minnesota", "MO": "Missouri", "MS": "Mississippi", "MT": "Montana", "NC": "North Carolina", "ND": "North Dakota", "NE": "Nebraska", "NH": "New Hampshire", "NJ": "New Jersey", "NM": "New Mexico", "NV": "Nevada", "NY": "New York", "OH": "Ohio", "OK": "Oklahoma", "OR": "Oregon", "PA": "Pennsylvania", "RI": "Rhode Island", "SC": "South Carolina", "SD": "South Dakota", "TN": "Tennessee", "TX": "Texas", "UT": "Utah", "VA": "Virginia", "VT": "Vermont", "WA": "Washington", "WI": "Wisconsin", "WV": "West Virginia", "WY": "Wyoming"
			}
		};
		const calendarNames = {
			"bruml": "Brumal",
			"brumR": "Brumal (Roman)",
			"chine": "Chinese",
			"coptc": "Coptic",
			"coptN": "Coptic-Nabu",
			"egypt": "Egyptian",
			"frenc": "French",
			"frenD": "French (decimal)",
			"germn": "Germanic",
			"gregr": "Gregorian",
			"iceln": "Icelandic",
			"intrn": "Internal",
			"islam": "Islamic",
			"isowk": "ISO-week",
			"japaL": "Japanese (lunar)",
			"japaS": "Japanese (solar)",
			"julin": "Julian",
			"maria": "Marian",
			"mariN": "Marian (Norse)",
			"roman": "Roman",
			"rumii": "Rumi",
			"swedi": "Swedish"
		};
		const calendarYears = {
			"bruml": "Western",
			"brumR": "Roman",
			"chine": "Chinese",
			"coptc": "Martyrs",
			"coptN": "Martyrs",
			"egypt": "Nabonassar",
			"frenc": "French",
			"frenD": "French",
			"germn": "Germanic",
			"gregr": "Western",
			"iceln": "Icelandic",
			"intrn": "none",
			"islam": "Hijrah",
			"isowk": "Western",
			"japaL": "Japanese",
			"japaS": "Japanese",
			"julin": "Western",
			"maria": "Western",
			"mariN": "Western",
			"roman": "Roman",
			"rumii": "Hijrah",
			"swedi": "Western"
		};
		const calendarTime = {
			"bruml": "24 hours",
			"brumR": "24 hours",
			"chine": "24 hours",
			"coptc": "24 hours",
			"coptN": "24 hours",
			"egypt": "24 hours",
			"frenc": "24 hours",
			"frenD": "10 hours",
			"germn": "8 stounds",
			"gregr": "24 hours",
			"iceln": "24 hours",
			"intrn": "86400 s",
			"islam": "24 hours",
			"isowk": "24 hours",
			"japaL": "24 hours",
			"japaS": "24 hours",
			"julin": "24 hours",
			"maria": "24 hours",
			"mariN": "8 stounds",
			"roman": "24 hours",
			"rumii": "24 hours",
			"swedi": "24 hours"
		};
		const timezoneCode = {
			"tz_afr_centl": "CAT",
			"tz_afr_eastn": "EAT",
			"tz_afr_westn": "WAT",
			"tz_aq_casey_stnd": "CAST",
			"tz_aq_casey_sumr": "CAST",
			"tz_arab_stnd": "AST",
			"tz_au_centl_dlst": "ACDT",
			"tz_au_centl_stnd": "ACST",
			"tz_au_cwest_dlst": "ACWDT",
			"tz_au_cwest_stnd": "ACWST",
			"tz_au_eastn_dlst": "AEDT",
			"tz_au_eastn_stnd": "AEST",
			"tz_au_westn_dlst": "AWDT",
			"tz_au_westn_stnd": "AWST",
			"tz_be_mean": "BMT",
			"tz_br_brasl": "BRT",
			"tz_br_brasl_sumr": "BRST",
			"tz_ch_bernn": "BMT",
			"tz_cn_bjing": "BJT",
			"tz_cn_stnd": "CST",
			"tz_cn_sumr": "CDT",
			"tz_dk_kopnh": "CMT",
			"tz_eur_centl": "CET",
			"tz_eur_centl_mids": "CEMT",
			"tz_eur_centl_sumr": "CEST",
			"tz_eur_eastn": "EET",
			"tz_eur_eastn_sumr": "EEST",
			"tz_eur_frest": "FET",
			"tz_eur_frest_sumr": "FEST",
			"tz_eur_westn": "WET",
			"tz_eur_westn_mids": "WEMT",
			"tz_eur_westn_sumr": "WEST",
			"tz_fi_hlski": "HMT",
			"tz_fr_paris": "PMT",
			"tz_gb_dble": "BDT",
			"tz_gb_greenwich": "GMT",
			"tz_gb_sumr": "BST",
			"tz_gl_centl": "CGT",
			"tz_gl_centl_sumr": "CGST",
			"tz_gl_eastn": "EGT",
			"tz_gl_eastn_sumr": "EGST",
			"tz_gl_westn": "WGT",
			"tz_gl_westn_sumr": "WGST",
			"tz_ht_potpr": "PPMT",
			"tz_ie_sumr": "IST",
			"tz_is_stnd": "IST",
			"tz_is_sumr": "ISST",
			"tz_jp_centl": "JCST",
			"tz_jp_stnd": "JST",
			"tz_jp_sumr": "JDT",
			"tz_jp_tokyo": "JST",
			"tz_jp_westn": "JWST",
			"tz_ko_dlst": "KDT",
			"tz_ko_stnd": "KST",
			"tz_ld_howe_dlst": "LHDT",
			"tz_ld_howe_stnd": "LHST",
			"tz_line_islands": "LINT",
			"tz_nam_atlnt_dbdt": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>ADDT",
			"tz_nam_atlnt_dlst": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>ADT",
			"tz_nam_atlnt_prvl": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>APT",
			"tz_nam_atlnt_stnd": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>AST",
			"tz_nam_atlnt_wart": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>AWT",
			"tz_nam_centl_dbdt": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>CDDT",
			"tz_nam_centl_dlst": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>CDT",
			"tz_nam_centl_prvl": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>CPT",
			"tz_nam_centl_stnd": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>CST",
			"tz_nam_centl_wart": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>CWT",
			"tz_nam_eastn_dbdt": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>EDDT",
			"tz_nam_eastn_dlst": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>EDT",
			"tz_nam_eastn_prvl": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>EPT",
			"tz_nam_eastn_stnd": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>EST",
			"tz_nam_eastn_wart": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>EWT",
			"tz_nam_moutn_dbdt": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>MDDT",
			"tz_nam_moutn_dlst": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>MDT",
			"tz_nam_moutn_prvl": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>MPT",
			"tz_nam_moutn_stnd": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>MST",
			"tz_nam_moutn_wart": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>MWT",
			"tz_nam_pacfc_dbdt": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>PDDT",
			"tz_nam_pacfc_dlst": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>PDT",
			"tz_nam_pacfc_prvl": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>PPT",
			"tz_nam_pacfc_stnd": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>PST",
			"tz_nam_pacfc_wart": "<span style=\"color:rgba(0,0,0,0.5)\">NA</span>PWT",
			"tz_nl_amstr": "AMT",
			"tz_nl_stnd": "NET",
			"tz_nl_sumr_new": "NEST",
			"tz_nl_sumr_old": "NST",
			"tz_nz_dlst": "NZDT",
			"tz_nz_mean": "NZMT",
			"tz_nz_stnd": "NZST",
			"tz_nz_sumr": "NZST",
			"tz_ph_dlst": "PhDT",
			"tz_ph_stnd": "PhST",
			"tz_pl_warsw": "WMT",
			"tz_ru_mskva": "MSK",
			"tz_ru_mskva_dble": "MDST",
			"tz_ru_mskva_dlst": "MSD",
			"tz_ru_mskva_mean": "MMT",
			"tz_ru_mskva_mids": "MSM",
			"tz_ru_mskva_stnd": "MSK",
			"tz_ru_mskva_sumr": "MST",
			"tz_se_stnd": "SET",
			"tz_us_alask_dlst": "AKDT",
			"tz_us_alask_stnd": "AKST",
			"tz_us_hawal_dlst": "HADT",
			"tz_us_hawal_stnd": "HAST",
			"tz_ws_mean": "SAMT",
			"tz_ws_westn": "WST",
			"tz_za_stnd": "SAST❄︎",
			"tz_za_sumr": "SAST☀︎",
			"tz_zz_local_mean": "LMT",
			"tz_zz_local_solar": "TST",
			"tz_zz_utc": "UTC"
		};
		const weekdayValue = {
			"Mon": "1",
			"Tue": "2",
			"Wed": "3",
			"Thu": "4",
			"Fri": "5",
			"Sat": "6",
			"Sun": "0"
		};

		function importXML() {
			const parser = new DOMParser();
			const xmlDoc = parser.parseFromString(xmlInput.value, "text/xml");

			const location = xmlDoc.getElementsByTagName('location')[0];
			
            const serializer = new XMLSerializer();
            const xmlString = serializer.serializeToString(xmlDoc);
            const firstLine = xmlString.split('\n')[0];
			locName.value = firstLine.match(/(?:(?:\/|<!--) ([^\/]+) -->|)$/)[1] || "";

			locID.value = location.getAttribute('id');
			country.value = location.getAttribute('c');
			subdivision.value = location.getAttribute('s');
			district.value = location.getAttribute('d');
			latitude.value = location.getAttribute('lat');
			longitude.value = location.getAttribute('long');

			const rules = xmlDoc.getElementsByTagName('rule');
			rulesSection.innerHTML = '';
			Array.from(rules).forEach(rule => addRule(rule));

			const years = xmlDoc.getElementsByTagName('year');
			yearsSection.innerHTML = '';
			Array.from(years).forEach(year => addYear(year));
			
			importButton.disabled = true;
		}
		function addRule(rule = null) {
			const ruleDiv = document.createElement('div');
			ruleDiv.classList.add('flex-container');
			ruleDiv.classList.add('rule');

			const day = rule ? rule.getAttribute('day') : '';
			const time = rule ? rule.getAttribute('time') : '';
			const cal = rule ? rule.getAttribute('cal') : '';
			const off = rule ? rule.getAttribute('off') : '';
			const tz = rule ? rule.getAttribute('tz') : '';
			const dst = rule ? rule.getAttribute('dst') : '0';
			const dstoff = rule ? rule.getAttribute('dstoff') : '';
			const dsttz = rule ? rule.getAttribute('dsttz') : '';
			const dstsd = rule ? rule.getAttribute('dstsd') : '';
			const dstsm = rule ? rule.getAttribute('dstsm') : '';
			const dstso = rule ? rule.getAttribute('dstso') : '';
			const dsted = rule ? rule.getAttribute('dsted') : '';
			const dstem = rule ? rule.getAttribute('dstem') : '';
			const dsteo = rule ? rule.getAttribute('dsteo') : '';

			ruleDiv.innerHTML = `
				<label>Day<\/label><input type="number" value="${day}" min="-9999999" max="9999999" style="width: 10ch;">
				<label>Time<\/label><input type="number" value="${time}" min="0" max="86399" style="width: 7ch;">
				<label>Calendar<\/label><input type="text" value="${cal}" maxlength="5" style="width: 5ch;">
				<label>Offset<\/label><input type="number" value="${off}" min="-86400" max="86400" style="width: 8ch;">
				<label>Timezone<\/label><input type="text" value="${tz}" maxlength="17" style="width: 17ch;">
				<label>Summertime<\/label><input type="checkbox" ${dst == '1' ? 'checked' : ''}>
				<div class="flex-container dst-details" style="${dst == '1' ? '' : 'display:none'}">
					<label>Summertime:<\/label>
					<label>Offset<\/label><input type="number" value="${dstoff}" min="-86400" max="86400" style="width: 8ch;">
					<label>Timezone<\/label><input type="text" value="${dsttz}" maxlength="17" style="width: 17ch;">
					<label>Start: Day<\/label><input type="text" value="${dstsd}" maxlength="4" style="width: 4ch;">
					<label>Month<\/label><input type="number" value="${dstsm}" min="1" max="99" style="width: 4ch;">
					<label>Time<\/label><input type="number" value="${dstso}" min="0" max="86399" style="width: 8ch;">
					<label>End: Day<\/label><input type="text" value="${dsted}" maxlength="4" style="width: 4ch;">
					<label>Month<\/label><input type="number" value="${dstem}" min="1" max="99" style="width: 4ch;">
					<label>Time<\/label><input type="number" value="${dsteo}" min="0" max="86399" style="width: 8ch;">
				<\/div>
			`;
			ruleDiv.querySelector('input[type="checkbox"]').addEventListener('change', function() {
				const dstDetails = this.parentNode.querySelector('.dst-details');
				dstDetails.style.display = this.checked ? 'flex' : 'none';
			});
			rulesSection.appendChild(ruleDiv);
		}
		function addYear(year = null) {
			const yearDiv = document.createElement('div');
			yearDiv.classList.add('flex-container');
			yearDiv.classList.add('year');

			const id = year ? year.getAttribute('id') : '';
			const calA = year ? year.getAttribute('calA') : '';
			const calB = year ? year.getAttribute('calB') : '';
			const Astart = year ? year.getAttribute('Astart') : '';
			const Aend = year ? year.getAttribute('Aend') : '';
			const Bstart = year ? year.getAttribute('Bstart') : '';
			const Bend = year ? year.getAttribute('Bend') : '';
			const app = year ? year.getAttribute('app') : '0';

			yearDiv.innerHTML = `
				<label>ID<\/label><input type="text" value="${id}" style="width: 2ch;">
				<label>Cal A<\/label><input type="text" value="${calA}" maxlength="5" style="width: 5ch;">
				<label>Cal B<\/label><input type="text" id="calB" value="${calB}" maxlength="5" style="width: 5ch;">
				<label>Start Date A<\/label><input type="text" value="${Astart}" maxlength="12" style="width: 12ch;">
				<label>End Date A<\/label><input type="text" value="${Aend}" maxlength="12" style="width: 12ch;">
				<div class="flex-container cal-details" style="${calB != '' ? '' : 'display:none'}">
					<label>Start Date B<\/label><input type="text" value="${Bstart}" maxlength="12" style="width: 12ch;">
					<label>End Date B<\/label><input type="text" value="${Bend}" maxlength="12" style="width: 12ch;">
					<label>Append Month<\/label><input type="checkbox" ${app == '0' ? '' : 'checked'}>
				<\/div>
			`;

			yearDiv.querySelector('input[type="text"][id="calB"]').addEventListener('input', function() {
				const calDetails = this.parentNode.querySelector('.cal-details');
				calDetails.style.display = !!this.value.trim() ? 'flex' : 'none';
			});

			yearsSection.appendChild(yearDiv);
		}
		
		function generateResults() {
			let regionCode = country.value+(subdivision.value?"-"+subdivision.value:"")+(district.value?"-"+district.value:"");
			const lat = Number(latitude.value).toFixed(7);
			const lon = Number(longitude.value).toFixed(7);
			let result = `<table><tr><th>code<\/th><th>name<\/th><th>region<\/th><th>latitude<\/th><th>longitude<\/th><\/tr>
			<tr><td>${locID.value}<\/td><td>${locName.value}<\/td><td>${regionCode}<\/td><td>${lat}<\/td><td>${lon}<\/td><\/table>`
			result += `<table><tr><th colspan="2">internal<\/th><th style="width: 23ch;">from date<\/th><th><\/th><th style="width: 23ch;">to date<\/th><th>calendar<\/th><th style="width: 12ch;">offset<\/th><th colspan="2">timezone<\/th><\/tr>`;
			const rules = rulesSection.getElementsByClassName('rule');
			Array.from(rules).forEach((rule, i, array) => {
				/* load variables for current, future and past entry */
				const inputs = rule.getElementsByTagName('input');
				const values = [parseInt(inputs[0].value),parseInt(inputs[1].value),inputs[2].value,parseInt(inputs[3].value),inputs[4].value,inputs[5].checked,parseInt(inputs[6].value),inputs[7].value,inputs[8].value,parseInt(inputs[9].value),parseInt(inputs[10].value),inputs[11].value,parseInt(inputs[12].value),parseInt(inputs[13].value)];
				let inputsFutr = null;
				if (i>0) {inputsFutr = array[i-1].getElementsByTagName('input');}
				const valuesFutr = inputsFutr===null?null:[parseInt(inputsFutr[0].value),parseInt(inputsFutr[1].value),inputsFutr[2].value,parseInt(inputsFutr[3].value),inputsFutr[4].value,inputsFutr[5].checked,parseInt(inputsFutr[6].value),inputsFutr[7].value,inputsFutr[8].value,parseInt(inputsFutr[9].value),parseInt(inputsFutr[10].value),inputsFutr[11].value,parseInt(inputsFutr[12].value),parseInt(inputsFutr[13].value)];
				let inputsPast = null;
				if (i<array.length-1) {inputsPast = array[i+1].getElementsByTagName('input');}
				const valuesPast = inputsPast===null?null:[parseInt(inputsPast[0].value),parseInt(inputsPast[1].value),inputsPast[2].value,parseInt(inputsPast[3].value),inputsPast[4].value,inputsPast[5].checked,parseInt(inputsPast[6].value),inputsPast[7].value,inputsPast[8].value,parseInt(inputsPast[9].value),parseInt(inputsPast[10].value),inputsPast[11].value,parseInt(inputsPast[12].value),parseInt(inputsPast[13].value)];
				
				/* prepare variables */
				let dateString = "";
				let dateStringPast = "";
				let calendar = calendarNames[values[2]];
				let offset = "";
				let tzCode = "";
				
				/* print out each time it changes during summertime */
				if (inputs[5].checked) {
					let maxDate = 748747; // 2050-12-31
					let maxTime = 86399; // last second of the day
					if (valuesFutr !== null) {
						maxDate = valuesFutr[0];
						maxTime = valuesFutr[1];
					}
					let summerArray = getSummertimeArray(values[2],maxDate,maxTime,values[0],values[1],values[3],values[6],values[8],values[9],values[10],values[11],values[12],values[13]);
					for (let i=0;i<summerArray.length;i+=1) {
						if (summerArray[i][2]) { // summertime ends
							dateString = datetimeString(values[2],summerArray[i][0],summerArray[i][1],values[3]);
							dateStringPast = datetimeString(values[2],summerArray[i][0],summerArray[i][1],values[6]);
							offset = values[3]<0?"UTC-"+secondsString(0-values[3]):"UTC+"+secondsString(values[3]);
							tzCode = timezoneCode[values[4]];
							result += `<tr><td align="right">${summerArray[i][0]}<\/td><td align="right">${summerArray[i][1]}<\/td><td>${dateStringPast}<\/td><td>→<\/td><td>${dateString}<\/td><td>${calendar}<\/td><td>${offset}<\/td><td>${tzCode}<\/td><td>(${values[4]})<\/td><\/tr>`;
						} else { // summertime begins
							dateString = datetimeString(values[2],summerArray[i][0],summerArray[i][1],values[6]);
							dateStringPast = datetimeString(values[2],summerArray[i][0],summerArray[i][1],values[3]);
							offset = values[6]<0?"UTC-"+secondsString(0-values[6]):"UTC+"+secondsString(values[6]);
							tzCode = timezoneCode[values[7]];
							result += `<tr><td align="right">${summerArray[i][0]}<\/td><td align="right">${summerArray[i][1]}<\/td><td>${dateStringPast}<\/td><td>→<\/td><td>${dateString}<\/td><td>${calendar}<\/td><td>${offset}<\/td><td>${tzCode}<\/td><td>(${values[7]})<\/td><\/tr>`;
						}
					}
				}
				
				/* print out the entry itself */
				dateString = datetimeString(values[2],values[0],values[1],values[3]);
				dateStringPast = "";
				offset = values[3]<0?"UTC-"+secondsString(0-values[3]):"UTC+"+secondsString(values[3]);
				tzCode = timezoneCode[values[4]];
				if (valuesPast != null) {
					dateStringPast = datetimeString(valuesPast[2],values[0],values[1]-1,valuesPast[3]);
					if (values[2] == valuesPast[2] && values[3] == valuesPast[3] && values[4] == valuesPast[4]) {
						result += `<tr><td align="right"><b>${values[0]}<\/b><\/td><td align="right"><b>${values[1]}<\/b><\/td><td>${dateStringPast}<\/td><td>→<\/td><td>${dateString}<\/td><td colspan="4" style="color:rgba(0,0,0,0.5)"><i>only change in the rule for when summertime occurs<\/i><\/td><\/tr>`;
					} else {
						result += `<tr><td align="right"><b>${values[0]}<\/b><\/td><td align="right"><b>${values[1]}<\/b><\/td><td>${dateStringPast}<\/td><td>→<\/td><td>${dateString}<\/td><td>${calendar}<\/td><td>${offset}<\/td><td>${tzCode}<\/td><td>(${values[4]})<\/td><\/tr>`;
					}
				} else {
					result += `<tr><td align="right"><b>${values[0]}<\/b><\/td><td align="right"><b>${values[1]}<\/b><\/td><td><\/td><td><\/td><td>${dateString}<\/td><td>${calendar}<\/td><td>${offset}<\/td><td>${tzCode}<\/td><td>(${values[4]})<\/td><\/tr>`;
				}
			});
			result += `<\/table>`;
			resultOutput.innerHTML = result;
		}
		function getSummertimeArray(cal,maxDate,maxTime,startDate,startTime,offsetBefore,offsetDuring,startRule,startMonth,startOff,endRule,endMonth,endOff) {
			const yearMax = dateToCal(maxDate,cal)[1];
			const yearMin = dateToCal(startDate,cal)[1];
			const yearRange = yearMax-yearMin+1;
			
			let list = [];
			for (let i=0;i<yearRange;i+=1) {
				const datumEnd = dayMonthRule(cal,yearMax-i,endMonth,endRule);
				const datumStart = dayMonthRule(cal,yearMax-i,startMonth,startRule);
				let dateEnd = calToDate(cal,datumEnd[1],datumEnd[2],datumEnd[3]);
				let dateStart = calToDate(cal,datumStart[1],datumStart[2],datumStart[3]);
				let timeEnd = 0-offsetDuring+endOff;
				let timeStart = 0-offsetBefore+startOff;
				if (timeEnd < 0) {
					timeEnd += 86400;
					dateEnd -= 1;
				} else if (timeEnd >= 86400) {
					timeEnd -= 86400;
					dateEnd += 1;
				}
				if (timeStart < 0) {
					timeStart += 86400;
					dateStart -= 1;
				} else if (timeStart >= 86400) {
					timeStart -= 86400;
					dateStart += 1;
				}
				if ((dateEnd < maxDate || (dateEnd === maxDate && timeEnd < maxTime)) && (dateEnd > startDate || (dateEnd === startDate && timeEnd >= startTime))) {
					list.push([dateEnd,timeEnd,1]);
				}
				if ((dateStart < maxDate || (dateStart === maxDate && timeStart < maxTime)) && (dateStart > startDate || (dateStart === startDate && timeStart >= startTime))) {
					list.push([dateStart,timeStart,0]);
				}
			}
			return list;
		}
		function dayMonthRule(cal,year,month,rule) {
			let dir = -1;
			let wd = -1;
			let occ = -1;
			let wdfound = -1;
			if (rule.match('^[1-9][FMSTW][a-z]{2}$')) {
				dir = 1;
				occ = parseInt(rule.charAt(0));
				wd = rule.slice(-3);
			} else if (rule.match('^[LPATQ][FMSTW][a-z]{2}$')) {
				dir = 2;
				const ruleMap = { /* last, penultimate, antepenultimate, tetraultimate, quintultimate */
					'L': 1, 'P': 2, 'A': 3, 'T': 4, 'Q': 5
				};
				occ = ruleMap[rule.charAt(0)];
				wd = rule.slice(-3);
			}
			if (cal == "gregr" || cal == "julin") {
				const weekdayMap = {
					"Sun": 0, "Mon": 1, "Tue": 2, "Wed": 3, "Thu": 4, "Fri": 5, "Sat": 6
				}
				wd = weekdayMap[wd];
				if (dir == 1) {
					const monthLength = daysInMonth(cal,year,month);
					wdfound = calToDate(cal,year,month,1).mod(7);
					let day = (wd-wdfound+7).mod(7)+1+(7*(occ-1));
					if (day > monthLength) {
						month += 1;
						if (month > 12) {
							year += 1;
							month -= 12;
						}
						day -= monthLength;
					};
					return [cal,year,month,day];
				} else if (dir == 2) {
					const monthLength = daysInMonth(cal,year,month);
					wdfound = calToDate(cal,year,month,monthLength).mod(7);
					let day = monthLength-(wdfound-wd+7).mod(7)-(7*(occ-1));
					if (day < 1) {
						month -= 1;
						if (month < 1) {
							year -= 1;
							month += 12;
						}
						day += daysInMonth(cal,year,month);
					};
					return [cal,year,month,day];
				}
			}
		}
		function generateXML() {
			const countryFullName = countryNames[country.value] || ((country.value === "ZZ") ? "" : country.value);
			const subdivisionFullName = subdivisionNames[country.value]?.[subdivision.value] || subdivision.value;
			const comment = `<!-- ${countryFullName ? countryFullName + ' / ' : ''}${subdivisionFullName ? subdivisionFullName + ' / ' : ''}${locName.value} -->`;
			const lat = Number(latitude.value).toFixed(7);
			const lon = Number(longitude.value).toFixed(7);

			let xml = `<location id="${locID.value}" c="${country.value}" s="${subdivision.value}" d="${district.value}" lat="${lat}" lon="${lon}"> ${comment}\n`;
			xml += '	<rules>\n';

			const rules = rulesSection.getElementsByClassName('rule');
			Array.from(rules).forEach(rule => {
				const inputs = rule.getElementsByTagName('input');
				xml += `		<rule day="${inputs[0].value}" time="${inputs[1].value}" cal="${inputs[2].value}" off="${inputs[3].value}" tz="${inputs[4].value}"`;
				if (inputs[5].checked) {
					xml += ` dst="1" dstoff="${inputs[6].value}" dsttz="${inputs[7].value}" dstsd="${inputs[8].value}" dstsm="${inputs[9].value}" dstso="${inputs[10].value}" dsted="${inputs[11].value}" dstem="${inputs[12].value}" dsteo="${inputs[13].value}"`;
				} else {
					xml += ' dst="0"';
				}
				xml += '/>\n';
			});

			xml += '	</rules>\n	<years>\n';

			const years = yearsSection.getElementsByClassName('year');
			Array.from(years).forEach(year => {
				const inputs = year.getElementsByTagName('input');
				xml += `		<year id="${inputs[0].value}" calA="${inputs[1].value}" calB="${inputs[2].value}" Astart="${inputs[3].value}" Aend="${inputs[4].value}"`;
				if (inputs[2].value.trim()) {
					xml += ` Bstart="${inputs[5].value}" Bend="${inputs[6].value}" app="${inputs[7].checked ? '1' : '0'}"`;
				}
				xml += '/>\n';
			});

			xml += '	</years>\n</location>';
			xmlOutput.textContent = xml;
			
			generateResults();
			outputButton.disabled = false;
		}
		function copyXML() {
			navigator.clipboard.writeText(xmlOutput.textContent);
			outputButton.disabled = true;
		}
		importButton.addEventListener('click', generateXML);
		rulesButton.addEventListener('click', generateXML);
		yearsButton.addEventListener('click', generateXML);
		xmlInput.addEventListener('input', fixInputXML);
		rulesSection.addEventListener('input', generateXML);
		yearsSection.addEventListener('input', generateXML);
		document.querySelectorAll('input').forEach(input => input.addEventListener('input', generateXML));
		generateXML();
		
		function dateToCal(date,cal) {
			switch(cal) {
				case "gregr": {
					let xA = date+365;
					let xB = Math.floor(xA/146097);
					let xC = xA-xB*146097-1;
					let xD = Math.max(Math.floor(xC/36524),0);
					let xE = xC-xD*36524+1;
					let xF = Math.max(Math.floor(xE/365.25),0);
					let xG = xE-Math.floor(xF*365.25);
					let dY = xB*400+xD*100+xF;
					let xH = isLeapYear("gregr",dY);
					let dM = 0;
					let dD = 0;
					if (xG >= 60) {
						if (xG<91) {
							dM = 3; dD = xG-59;
						} else if (xG<121) {
							dM = 4; dD = xG-90;
						} else if (xG<152) {
							dM = 5; dD = xG-120;
						} else if (xG<182) {
							dM = 6; dD = xG-151;
						} else if (xG<213) {
							dM = 7; dD = xG-181;
						} else if (xG<244) {
							dM = 8; dD = xG-212;
						} else if (xG<274) {
							dM = 9; dD = xG-243;
						} else if (xG<305) {
							dM = 10; dD = xG-273;
						} else if (xG<335) {
							dM = 11; dD = xG-304;
						} else {
							dM = 12; dD = xG-334;
						}
					} else {
						dM = (xG+xH>31?2:1);
						dD = (xG+xH>31?xG+xH-31:xG+xH);
					}
					return ["gregr",dY,dM,dD,date.mod(7)]; // calendar, year, month, day, weekday
				}
				case "julin": {
					let dY = 0;
					if (date>0) {
						dY = Math.floor((date+367)/365.25)
					} else if (date>-2557) {
						dY = Math.floor((date+366)/365)
					} else {
						dY = Math.floor((date+365)/365.333333333)
					}
					let xA = 0;
					if (date>0) {
						xA = date+367-Math.floor(dY*365.25);
					} else if (date>-2557) {
						xA = date+367-dY*365;
					} else {
						xA = date+365+365-Math.floor((dY+1)*365.333333333);
					}
					let xB = isLeapYear("julin",dY);

					let dM = 0;
					let dD = 0;
					if (xA >= 60) {
						if (xA<91) {
							dM = 3; dD = xA-59;
						} else if (xA<121) {
							dM = 4; dD = xA-90;
						} else if (xA<152) {
							dM = 5; dD = xA-120;
						} else if (xA<182) {
							dM = 6; dD = xA-151;
						} else if (xA<213) {
							dM = 7; dD = xA-181;
						} else if (xA<244) {
							dM = 8; dD = xA-212;
						} else if (xA<274) {
							dM = 9; dD = xA-243;
						} else if (xA<305) {
							dM = 10; dD = xA-273;
						} else if (xA<335) {
							dM = 11; dD = xA-304;
						} else {
							dM = 12; dD = xA-334;
						}
					} else {
						dM = (xA+xB>31?2:1);
						dD = (xA+xB>31?xA+xB-31:xA+xB);
					}
					return ["julin",dY,dM,dD,date.mod(7)]; // calendar, year, month, day, weekday
				}
				default:
					throw Error("Unsupported type in dateToCal ('"+cal+"')");
			}
		}
		function calToDate(cal,year,month,day) {
			switch(cal) {
				case "gregr":
					return (year-1)*365+Math.floor((year-1)/4)-Math.floor((year-1)/100)+Math.floor((year-1)/400)+daysElapsed("gregr",year,month)+day;
				case "julin":
					if (year>0) {
						return (year-1)*365+Math.floor((year-1)/4)+daysElapsed("julin",year,month)+day-2;
					} else if (year>-7) {
						return (year-1)*365+daysElapsed("julin",year,month)+day-2;
					} else {
						return (year-1)*365+Math.floor(year/3)+2+daysElapsed("julin",year,month)+day-2;
					}
				default:
					throw Error("Unsupported type in calToDate ('"+cal+"')");
			}
		}
		function isLeapYear(cal,year) {
			switch(cal) {
				case "gregr":
				case "swedi":
					return (year.mod(4) === 0 && year.mod(100) !== 0) || (year.mod(400) === 0);
				case "julin":
					if (year>0) {
						return year.mod(4) === 0;
					} else if (year>-7) {
						return 0;
					} else {
						return (year+1).mod(3) === 0;
					}
				default:
					throw Error("Unsupported type in isLeapYear ('"+cal+"')");
			}
		}
		function daysElapsed(cal,year,month) {
			switch(cal) {
				case "julin":
				case "gregr":
				case "swedi":
					const cumul = [0,31,59,90,120,151,181,212,243,273,304,334,365];
					if (isLeapYear(cal,year) && month>2) {
						return cumul[month-1]+1;
					} else {
						return cumul[month-1];
					}
				default:
					throw Error("Unsupported type in daysElapsed ('"+cal+"')");
			}
		}
		function daysInMonth(cal,year,month) {
			switch(cal) {
				case "julin":
				case "gregr":
				case "swedi":
					const cumul = [31,isLeapYear(cal,year)?29:28,31,30,31,30,31,31,30,31,30,31];
					return cumul[month-1];
				default:
					throw Error("Unsupported type in daysElapsed ('"+cal+"')");
			}
		}
		
		function datetimeString(cal,date,time,offset) {
			dateResult = "??? ????-??-??";
			timeResult = "??:??:??";
			time = time+offset;
			if (time < 0) {
				date -= 1;
				time += 86400;
			} else if (time >= 86400) {
				date += 1;
				time -= 86400;
			}
			
			/* DATE */
			if (cal == "gregr") {
				const cW = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
				let calResult = dateToCal(date,"gregr");
				dateResult = cW[calResult[4]]+" "+calResult[1]+"-"+(calResult[2]<10?"0":"")+calResult[2]+"-"+(calResult[3]<10?"0":"")+calResult[3];
			} else if (cal == "julin") {
				const cW = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
				let calResult = dateToCal(date,"julin");
				dateResult = cW[calResult[4]]+" "+calResult[1]+"-"+(calResult[2]<10?"0":"")+calResult[2]+"-"+(calResult[3]<10?"0":"")+calResult[3];
			} else if (cal == "swedi") {
				const cM = [0,31,59,90,120,151,181,212,243,273,304,334,365];
				const cW = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"];
				
				let xA = date+355;
				if (date > 625000) {
					xA = date+356;
				}
				let xB = Math.floor(xA/146097);
				let xC = xA-xB*146097-1;
				let xD = Math.max(Math.floor(xC/36524),0);
				let xE = xC-xD*36524+1;
				let xF = Math.max(Math.floor(xE/365.25),0);
				let xG = xE-Math.floor(xF*365.25);
				let xH = 0;

				let dY = xB*400+xD*100+xF;
				if (dY == 1712) {
					xH = 2;
				} else if (dY.mod(400) == 0 || (dY.mod(4) == 0 && dY.mod(100) != 0)) {
					xH = 1;
				}
				let dM = 0;
				let dD = 0;
				if (xG >= 60) {
					if (xG<91) {
						dM = 3;
						dD = xG-59;
					} else if (xG<121) {
						dM = 4;
						dD = xG-90;
					} else if (xG<152) {
						dM = 5;
						dD = xG-120;
					} else if (xG<182) {
						dM = 6;
						dD = xG-151;
					} else if (xG<213) {
						dM = 7;
						dD = xG-181;
					} else if (xG<244) {
						dM = 8;
						dD = xG-212;
					} else if (xG<274) {
						dM = 9;
						dD = xG-243;
					} else if (xG<305) {
						dM = 10;
						dD = xG-273;
					} else if (xG<335) {
						dM = 11;
						dD = xG-304;
					} else {
						dM = 12;
						dD = xG-334;
					}
				} else {
					dM = (xG+xH>31?2:1);
					dD = (xG+xH>31?xG+xH-31:xG+xH);
				}
				if (date == 625000) {
					dM = 2;
					dD = 30;
				}

				let dE = cW[date.mod(7)];
				
				dateResult = dE+" "+dY+"-"+(dM<10?"0":"")+dM+"-"+(dD<10?"0":"")+dD;
			}
			
			/* TIME */
			if (calendarTime[cal] == "24 hours") {
				timeResult = secondsString(time);
			} else if (calendarTime[cal] == "8 stounds") {
				let tH = Math.floor(time/10800);
				let tM = Math.floor((time-tH*10800)/5400);
				let tS = Math.floor(((time-tH*10800-tM*5400)/5400)*100000);
				timeResult = (tH+1)+(tM?"B":"A")+","+tS.toString().padStart(5, '0');
			}
			
			return dateResult+" "+timeResult;
		}
		function secondsString(seconds) {
			let tH = Math.floor(seconds/3600);
			let tM = Math.floor((seconds-tH*3600)/60);
			let tS = (seconds-tH*3600-tM*60);
			
			return (tH<10?"0":"")+tH+":"+(tM<10?"0":"")+tM+":"+(tS<10?"0":"")+tS;
		}
		function fixInputXML() {
			if (xmlInput.value.charAt(0) == '"') {
				xmlInput.value = xmlInput.value.replaceAll('""','¤').replaceAll('"','').replaceAll('¤','"');
			}
			importButton.disabled = false;
		}
		
	</script>
</body>
</html>